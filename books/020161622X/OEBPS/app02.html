<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:epub="http://www.idpf.org/2007/ops" xmlns:m="http://www.w3.org/1998/Math/MathML" xmlns:pls="http://www.w3.org/2005/01/pronunciation-lexicon" xmlns:ssml="http://www.w3.org/2001/10/synthesis" xmlns:svg="http://www.w3.org/2000/svg">
<head>
  <meta charset="UTF-8" />
  <title>Appendix B. Answers to Exercises</title>
  <link type="text/css" rel="stylesheet" media="all" href="style.css" />
  <link type="text/css" rel="stylesheet" media="all" href="core.css" />
</head>
<body>
  <div id="sbo-rt-content"><p><a id="app02"></a><a id="page_279"></a></p>
<h2 id="title-IDACCB1" class="docAppendixTitle">Appendix B<br/><br/>Answers to Exercises</h2>
<p class="docText"><a id="d1e19783"></a><strong><a href="app02.html#ch02ans01">Exercise 1:</a></strong> <em>from <a href="ch02.html#ch02lev1sec2">Orthogonality</a> on page <a href="ch02.html#page_43">43</a></em></p>
<p class="docText">You are writing a class called <code>Split</code>, which splits input lines into fields. Which of the following two Java class signatures is the more orthogonal design?</p>
<p class="progimage"><img src="images/p0279-01.jpg" alt="image" /></p>
<p class="docText"><a id="ch02ans01"></a><strong><a href="#d1e19783">Answer 1:</a></strong> <a href="ch02.html#ch02que01">To our way of thinking, class <code>Split2</code> is more orthogonal. It concentrates on its own task, splitting lines, and ignores details such as where the lines are coming from. Not only does this make the code easier to develop, but it also makes it more flexible. <code>Split2</code> can split lines read from a file, generated by another routine, or passed in via the environment</a>.</p>
<p class="docText"><a id="d1e19858"></a><strong><a href="app02.html#ch02ans02">Exercise 2:</a></strong> <em>from <a href="ch02.html#ch02lev1sec2">Orthogonality</a> on page <a href="ch02.html#page_43">43</a></em></p>
<p class="docText">Which will lead to a more orthogonal design: modeless or modal dialog boxes?</p>
<p class="docText"><a id="ch02ans02"></a><strong><a href="#d1e19858">Answer 2:</a></strong> <a href="ch02.html#ch02que02">If done correctly, probably modeless. A system that uses modeless dialog boxes will be less concerned with what is going on at any particular moment in time. It will likely have a better intermodule communications infrastructure than a modal system, which may have built-in assumptions about the state of the system—assumptions that lead to increased coupling and decreased orthogonality</a>.</p>
<p class="docText"><a id="page_280"></a><a id="d1e19882"></a><strong><a href="app02.html#ch02ans03">Exercise 3:</a></strong> <em>from <a href="ch02.html#ch02lev1sec2">Orthogonality</a> on page <a href="ch02.html#page_43">43</a></em></p>
<p class="docText">How about procedural languages versus object technology? Which results in a more orthogonal system?</p>
<p class="docText"><a id="ch02ans03"></a><strong><a href="#d1e19882">Answer 3:</a></strong> <a href="ch02.html#ch02que03">This is a little tricky. Object technology <em>can</em> provide a more orthogonal system, but because it has more features to abuse, it is actually easier to create a <em>nonorthogonal</em> system using objects than it is using a procedural language. Features such as multiple inheritance, exceptions, operator overloading, and parent-method overriding (via subclassing) provide ample opportunity to increase coupling in nonobvious ways</a>.</p>
<p class="docText">With object technology and a little extra effort, you can achieve a much more orthogonal system. But while you can always write "spaghetti code" in a procedural language, object-oriented languages used poorly can add meatballs to your spaghetti.</p>
<p class="docText"><a id="d1e19918"></a><strong><a href="app02.html#ch02ans04">Exercise 4:</a></strong> <em>from <a href="ch02.html#ch02lev1sec5">Prototypes and Post-it Notes</a> on page <a href="ch02.html#page_56">56</a></em></p>
<p class="docText">Marketing would like to sit down and brainstorm a few Web-page designs with you. They are thinking of clickable image maps to take you to other pages, and so on. But they can't decide on a model for the image—maybe it's a car, or a phone, or a house. You have a list of target pages and content; they'd like to see a few prototypes. Oh, by the way, you have 15 minutes. What tools might you use?</p>
<p class="docText"><a id="ch02ans04"></a><strong><a href="#d1e19918">Answer 4:</a></strong> <a href="ch02.html#ch02que04">Low-tech to the rescue! Draw a few cartoons with markers on a whiteboard—a car, a phone, and a house. It doesn't have to be great art; stick-figure outlines are fine. Put Post-it notes that describe the contents of target pages on the clickable areas. As the meeting progresses, you can refine the drawings and placements of the Post-it notes</a>.</p>
<p class="docText"><a id="d1e19945"></a><strong><a href="app02.html#ch02ans05">Exercise 5:</a></strong> <em>from <a href="ch02.html#ch02lev1sec6">Domain Languages</a> on page <a href="ch02.html#page_63">63</a></em></p>
<p class="docText">We want to implement a mini-language to control a simple drawing package (perhaps a turtle-graphics system). The language consists of single-letter commands. Some commands are followed by a single number. For example, the following input would draw a rectangle.</p>
<p class="progimage"><img src="images/p0280-01.jpg" alt="image" /></p>
<p class="docText">Implement the code that parses this language. It should be designed so that it is simple to add new commands.</p>
<p class="docText"><a id="page_281"></a><a id="ch02ans05"></a><strong><a href="#d1e19945">Answer 5:</a></strong> <a href="ch02.html#ch02que05">Because we want to make the language extendable, we'll make the parser table driven. Each entry in the table contains the command letter, a flag to say whether an argument is required, and the name of the routine to call to handle that particular command</a>.</p>
<p class="progimage"><img src="images/p0281-01.jpg" alt="image" /></p>
<p class="docText">The main program is pretty simple: read a line, look up the command, get the argument if required, then call the handler function.</p>
<p class="progimage"><img src="images/p0281-02.jpg" alt="image" /></p>
<p class="docText">The function that looks up a command performs a linear search of the table, returning either the matching entry or <code>NULL</code>.</p>
<p class="progimage"><img src="images/p0281-03.jpg" alt="image" /></p>
<p class="docText">Finally, reading the numeric argument is pretty simple using <code>sscanf</code>.</p>
<p class="progimage"><img src="images/p0281-04.jpg" alt="image" /></p>
<p class="docText"><a id="page_282"></a><a id="d1e20116"></a><strong><a href="app02.html#ch02ans06">Exercise 6:</a></strong> <em>from <a href="ch02.html#ch02lev1sec6">Domain Languages</a> on page <a href="ch02.html#page_63">63</a></em></p>
<p class="docText">Design a BNF grammar to parse a time specification. All of the following examples should be accepted.</p>
<p class="rogramlisting">    4pm, 7:38pm, 23:42, 3:16, 3:16am</p>
<p class="docText"><a id="ch02ans06"></a><strong><a href="#d1e20116">Answer 6:</a></strong> <a href="ch02.html#ch02que06">Using BNF, a time specification could be</a></p>
<p class="progimage"><img src="images/p0282-01.jpg" alt="image" /></p>
<p class="docText"><a id="d1e20190"></a><strong><a href="app02.html#ch02ans07">Exercise 7:</a></strong> <em>from <a href="ch02.html#ch02lev1sec6">Domain Languages</a> on page <a href="ch02.html#page_63">63</a></em></p>
<p class="docText">Implement a parser for the BNF grammar in Exercise 6 using <code>yacc</code>, <code>bison</code>, or a similar parser-generator.</p>
<p class="docText"><a id="ch02ans07"></a><strong><a href="#d1e20190">Answer 7:</a></strong> <a href="ch02.html#ch02que07">We coded our example using <code>bison</code>, the GNU version of <code>yacc</code>. For clarity, we're just showing the body of the parser here. Look at the source on our Web site for the full implementation</a>.</p>
<p class="progimage"><img src="images/p0282-02.jpg" alt="image" /></p>
<p class="progimage"><img src="images/p0283-01.jpg" alt="image" /></p>
<p class="docText"><a id="page_283"></a><a id="d1e20262"></a><strong><a href="app02.html#ch02ans08">Exercise 8:</a></strong> <em>from <a href="ch02.html#ch02lev1sec6">Domain Languages</a> on page <a href="ch02.html#page_63">63</a></em></p>
<p class="docText">Implement the time parser using Perl. [<em>Hint:</em> Regular expressions make good parsers.]</p>
<p class="docText"><a id="ch02ans08"></a><strong><a href="#d1e20262">Answer 8:</a></strong></p>
<p class="progimage"><img src="images/p0283-02.jpg" alt="image" /></p>
<p class="docText"><a id="d1e20338"></a><strong><a href="app02.html#ch02ans09">Exercise 9:</a></strong> <em>from <a href="ch02.html#ch02lev1sec7">Estimating</a> on page <a href="ch02.html#page_69">69</a></em></p>
<p class="docText">You are asked "Which has a higher bandwidth: a 1Mbps communications line or a person walking between two computers with a full 4GB tape in their pocket?" What constraints will you put on your answer to ensure that the scope of your response is correct? (For example, you might say that the time taken to access the tape is ignored.)</p>
<p class="docText"><a id="ch02ans09"></a><strong><a href="#d1e20338">Answer 9:</a></strong> <a href="ch02.html#ch02que09">Our answer must be couched in several assumptions</a>:</p>
<ul>
<li>The tape contains the information we need to be transferred.</li>
<li>We know the speed at which the person walks.</li>
<li>We know the distance between the machines.</li>
<li>We are not accounting for the time it takes to transfer information to and from the tape.</li>
<li><a id="page_284"></a>The overhead of storing data on a tape is roughly equal to the overhead of sending it over a communications line.</li>
</ul>
<p class="docText"><a id="d1e20387"></a><strong><a href="app02.html#ch02ans10">Exercise 10:</a></strong> <em>from <a href="ch02.html#ch02lev1sec7">Estimating</a> on page <a href="ch02.html#page_69">69</a></em></p>
<p class="docText">So, which has the higher bandwidth?</p>
<p class="docText"><a id="ch02ans10"></a><strong><a href="#d1e20387">Answer 10:</a></strong> <a href="ch02.html#ch02que10">Subject to the caveats in</a> <a href="ch02.html#ch02que09">Answer 9</a>: A 4GB tape contains 32 x 10<sup>9</sup> bits, so a 1Mbps line would have to pump data for about 32,000 seconds, or roughly 9 hours, to transfer the equivalent amount of information. If the person is walking at a constant 3½ mph, then our two machines would need to be at least 31 miles apart for the communications line to outperform our courier. Otherwise, the person wins.</p>
<p class="docText"><a id="d1e20420"></a><strong><a href="app02.html#ch03ans01">Exercise 11:</a></strong> <em>from <a href="ch03.html#ch03lev1sec6">Text Manipulation</a> on page <a href="ch03.html#page_102">102</a></em></p>
<p class="docText">Your C program uses an enumerated type to represent one of 100 states. You'd like to be able to print out the state as a string (as opposed to a number) for debugging purposes. Write a script that reads from standard input a file containing</p>
<p class="progimage"><img src="images/p0284-01.jpg" alt="image" /></p>
<p class="docText">Produce the file <em>name.h,</em> which contains</p>
<p class="progimage"><img src="images/p0284-02.jpg" alt="image" /></p>
<p class="docText">and the file <em>name.c,</em> which contains</p>
<p class="progimage"><img src="images/p0284-03.jpg" alt="image" /></p>
<p class="docText"><a id="page_285"></a><a id="ch03ans01"></a><strong><a href="#d1e20420">Answer 11:</a></strong> <a href="ch03.html#ch03que01">We implemented our answer using Perl</a>.</p>
<p class="progimage"><img src="images/p0285-01.jpg" alt="image" /></p>
<p class="docText">Using the <em>DRY</em> principle, we won't cut and paste this new file into our code. Instead, we'll <code>#include</code> it—the flat file is the master source of these constants. This means that we'll need a makefile to regenerate the header when the file changes. The following extract is from the test bed in our source tree (available on the Web site).</p>
<p class="progimage"><img src="images/p0285-02.jpg" alt="image" /></p>
<p class="docText"><a id="d1e20678"></a><strong><a href="app02.html#ch03ans02">Exercise 12:</a></strong> <em>from <a href="ch03.html#ch03lev1sec6">Text Manipulation</a> on page <a href="ch03.html#page_102">102</a></em></p>
<p class="docText">Halfway through writing this book, we realized that we hadn't put the <code>use strict</code> directive into many of our Perl examples. Write a script that goes through the <code>.pl</code> files in a directory and adds a <code>use strict</code> at the end of the initial comment block to all files that don't already have one. Remember to keep a backup of all files you change.</p>
<p class="docText"><a id="page_286"></a><a id="ch03ans02"></a><strong><a href="#d1e20678">Answer 12:</a></strong> <a href="ch03.html#ch03que02">Here's our answer, written in Perl</a>.</p>
<p class="progimage"><img src="images/p0286-01.jpg" alt="image" /></p>
<p class="docText"><a id="d1e20831"></a><strong><a href="app02.html#ch03ans03">Exercise 13:</a></strong> <em>from <a href="ch03.html#ch03lev1sec7">Code Generators</a> on page <a href="ch03.html#page_106">106</a></em></p>
<p class="docText">Write a code generator that takes the input file in <a href="ch03.html#ch03fig04">Figure 3.4</a>, page <a href="ch03.html#page_106">106</a>, and generates output in two languages of your choice. Try to make it easy to add new languages.</p>
<p class="docText"><a id="ch03ans03"></a><strong><a href="#d1e20831">Answer 13:</a></strong> <a href="ch03.html#ch03que03">We use Perl to implement our solution. It dynamically loads a module to generate the requested language, so adding new languages is easy. The main routine loads the back end (based on a command-line parameter), then reads its input and calls code generation routines based on the content of each line. We're not particularly fussy about error handling—we'll get to know pretty quickly if things go wrong</a>.</p>
<p class="progimage"><img src="images/p0286-02.jpg" alt="image" /></p>
<p class="docText"><a id="page_287"></a>Writing a language back end is simple: provide a module that implements the required six entry points. Here's the C generator:</p>
<p class="progimage"><img src="images/p0287-01.jpg" alt="image" /></p>
<p class="docText">And here's the one for Pascal:</p>
<p class="progimage"><img src="images/p0287-02.jpg" alt="image" /></p>
<p class="docText"><a id="d1e21126"></a><strong><a href="app02.html#ch04ans01">Exercise 14:</a></strong> <em>from <a href="ch04.html#ch04lev1sec1">Design by Contract</a> on page <a href="ch04.html#page_118">118</a></em></p>
<p class="docText">What makes a good contract? Anyone can add preconditions and postconditions, but will they do you any good? Worse yet, will they actually do more harm than good? For the example below and for those in Exercises 15 and 16, decide whether the specified contract is good, bad, or ugly, and explain why.</p>
<p class="docText">First, let's look at an Eiffel example. Here we have a routine for adding a <code>STRING</code> to a doubly linked, circular list (remember that preconditions are labeled with <code>require</code>, and postconditions with <code>ensure</code>).</p>
<p class="progimage"><img src="images/p0288-01.jpg" alt="image" /></p>
<p class="docText"><a id="page_288"></a><a id="ch04ans01"></a><strong><a href="#d1e21126">Answer 14:</a></strong> <a href="ch04.html#ch04que01">This Eiffel example is <em>good.</em> We require non-null data to be passed in, and we guarantee that the semantics of a circular, doubly linked list are honored. It also helps to be able to find the string we stored. Because this is a deferred class, the actual class that implements it is free to use whatever underlying mechanism it wants to. It may choose to use pointers, or an array, or whatever; as long as it honors the contract, we don't care</a>.</p>
<p class="docText"><a id="d1e21210"></a><strong><a href="app02.html#ch04ans02">Exercise 15:</a></strong> <em>from <a href="ch04.html#ch04lev1sec1">Design by Contract</a> on page <a href="ch04.html#page_119">119</a></em></p>
<p class="docText">Next, let's try an example in Java—somewhat similar to the example in Exercise 14. <code>insertNumber</code> inserts an integer into an ordered list. Pre- and postconditions are labeled as in iContract (see [<a href="app01.html#app01lev3sec17">URL 17</a>]).</p>
<p class="progimage"><img src="images/p0288-02.jpg" alt="image" /></p>
<p class="docText"><a id="ch04ans02"></a><strong><a href="#d1e21210">Answer 15:</a></strong> <a href="ch04.html#ch04que02">This is <em>bad.</em> The math in the index clause (<code>index-1</code>) won't work on boundary conditions such as the first entry</a>.</p>
<p class="docText">The postcondition assumes a particular implementation: we want contracts to be more abstract than that.</p>
<p class="docText"><a id="page_289"></a><a id="d1e21279"></a><strong><a href="app02.html#ch04ans03">Exercise 16:</a></strong> <em>from <a href="ch04.html#ch04lev1sec1">Design by Contract</a> on page <a href="ch04.html#page_119">119</a></em></p>
<p class="docText">Here's a fragment from a stack class in Java. Is this a good contract?</p>
<p class="progimage"><img src="images/p0289-01.jpg" alt="image" /></p>
<p class="docText"><a id="ch04ans03"></a><strong><a href="#d1e21279">Answer 16:</a></strong> <a href="ch04.html#ch04que03">It's a good contract, but a bad implementation. Here, the infamous "Heisenbug" [</a><a href="app01.html#app01lev3sec52">URL 52</a>] rears its <em>ugly</em> head. The programmer probably just made a simple typo—<code>pop</code> instead of <code>top</code>. While this is a simple and contrived example, side effects in assertions (or in any unexpected place in the code) can be very difficult to diagnose .</p>
<p class="docText"><a id="d1e21342"></a><strong><a href="app02.html#ch04ans04">Exercise 17:</a></strong> <em>from <a href="ch04.html#ch04lev1sec1">Design by Contract</a> on page <a href="ch04.html#page_119">119</a></em></p>
<p class="docText">The classic examples of DBC (as in Exercises 14–16) show an implementation of an ADT (Abstract Data Type)—typically a stack or queue. But not many people really write these kinds of low-level classes.</p>
<p class="docText">So, for this exercise, design an interface to a kitchen blender. It will eventually be a Web-based, Internet-enabled, CORBA-fied blender, but for now we just need the interface to control it. It has ten speed settings (0 means off). You can't operate it empty, and you can change the speed only one unit at a time (that is, from 0 to 1, and from 1 to 2, not from 0 to 2).</p>
<p class="docText">Here are the methods. Add appropriate pre- and postconditions and an invariant.</p>
<p class="progimage"><img src="images/p0289-02.jpg" alt="image" /></p>
<p class="docText"><a id="ch04ans04"></a><strong><a href="#d1e21342">Answer 17:</a></strong> <a href="ch04.html#ch04que04">We'll show the function signatures in Java, with the pre- and postconditions labeled as in iContract</a>.</p>
<p class="docText">First, the invariant for the class:</p>
<p class="progimage"><img src="images/p0289-03.jpg" alt="image" /></p>
<p class="docText">Next, the pre- and postconditions:</p>
<p class="progimage"><img src="images/p0290-01.jpg" alt="image" /></p>
<p class="docText"><a id="page_290"></a><a id="d1e21494"></a><strong><a href="app02.html#ch04ans05">Exercise 18:</a></strong> <em>from <a href="ch04.html#ch04lev1sec1">Design by Contract</a> on page <a href="ch04.html#page_119">119</a></em></p>
<p class="docText">How many numbers are in the series 0,5,10,15,..., 100?</p>
<p class="docText"><a id="ch04ans05"></a><strong><a href="#d1e21494">Answer 18:</a></strong> <a href="ch04.html#ch04que05">There are 21 terms in the series. If you said 20, you just experienced a fencepost error</a>.</p>
<p class="docText"><a id="d1e21521"></a><strong><a href="app02.html#ch04ans06">Exercise 19:</a></strong> <em>from <a href="ch04.html#ch04lev1sec3">Assertive Programming</a> on page <a href="ch04.html#page_125">125</a></em></p>
<p class="docText">A quick reality check. Which of these "impossible" things can happen?</p>
<ol>
<li>A month with fewer than 28 days</li>
<li><code>stat("." ,&amp;sb) == -1</code> (that is, can't access the current directory)</li>
<li>In <code>C++: a = 2;b = 3;</code> <strong><code>if</code></strong> <code>(a + b != 5) exit(1);</code></li>
<li>A triangle with an interior angle sum ≠ 180°</li>
<li>A minute that doesn't have 60 seconds</li>
<li>In Java: <code>(a + 1) &lt;= a</code></li>
</ol>
<p class="docText"><a id="ch04ans06"></a><strong><a href="#d1e21521">Answer 19:</a></strong></p>
<ol>
<li>September, 1752 had only 19 days. This was done to synchronize calendars as part of the Gregorian Reformation.</li>
<li>The directory could have been removed by another process, you might not have permission to read it, &amp;sb might be invalid—you get the picture.</li>
<li>We sneakily didn't specify the types of <code>a</code> and <code>b</code>. Operator overloading might have defined <code>+</code>, <code>=</code>, or <code>! =</code> to have unexpected behavior. Also, <code>a</code> and <code>b</code> may be aliases for the same variable, so the second assignment will overwrite the value stored in the first.</li>
<li>In non-Euclidean geometry, the sum of the angles of a triangle will not add up to 180°. Think of a triangle mapped on the surface of a sphere.</li>
<li><a id="page_291"></a>Leap minutes may have 61 or 62 seconds.</li>
<li>Overflow may leave the result of <code>a + 1</code> negative (this can also happen in C and C++).</li>
</ol>
<p class="docText"><a id="d1e21632"></a><strong><a href="app02.html#ch04ans07">Exercise 20:</a></strong> <em>from <a href="ch04.html#ch04lev1sec3">Assertive Programming</a> on page <a href="ch04.html#page_125">125</a></em></p>
<p class="docText">Develop a simple assertion checking class for Java.</p>
<p class="docText"><a id="ch04ans07"></a><strong><a href="#d1e21632">Answer 20:</a></strong> <a href="ch04.html#ch04que07">We chose to implement a very simple class with a single static method, <code>TEST</code>, that prints a message and a stack trace if the passed <code>condition</code> parameter is false</a>.</p>
<p class="progimage"><img src="images/p0291-01.jpg" alt="image" /></p>
<p class="docText"><a id="d1e21740"></a><strong><a href="app02.html#ch04ans08">Exercise 21:</a></strong> <em>from <a href="ch04.html#ch04lev1sec4">When to Use Exceptions</a> on page <a href="ch04.html#page_128">128</a></em></p>
<p class="docText">While designing a new container class, you identify the following possible error conditions:</p>
<ol>
<li>No memory available for a new element in the <code>add</code> routine</li>
<li>Requested entry not found in the <code>fetch</code> routine</li>
<li><code>null</code> pointer passed to the add routine</li>
</ol>
<p class="docText"><a id="page_292"></a>How should each be handled? Should an error be generated, should an exception be raised, or should the condition be ignored?</p>
<p class="docText"><a id="ch04ans08"></a><strong><a href="#d1e21740">Answer 21:</a></strong> <a href="ch04.html#ch04que08">Running out of memory is an exceptional condition, so we feel that case (1) should raise an exception</a>.</p>
<p class="docText">Failure to find an entry is probably quite a normal occurrence. The application that calls our collection class may well write code that checks to see if an entry is present before adding a potential duplicate. We feel that case (2) should just return an error.</p>
<p class="docText">Case (3) is more problematic—if the value <code>null</code> is significant to the application, then it may be justifiably added to the container. If, however, it makes no sense to store null values, an exception should probably be thrown.</p>
<p class="docText"><a id="d1e21803"></a><strong><a href="app02.html#ch04ans09">Exercise 22:</a></strong> <em>from <a href="ch04.html#ch04lev1sec5">How to Balance Resources</a> on page <a href="ch04.html#page_136">136</a></em></p>
<p class="docText">Some C and C++ developers make a point of setting a pointer to <code>NULL</code> after they deallocate the memory it references. Why is this a good idea?</p>
<p class="docText"><a id="ch04ans09"></a><strong><a href="#d1e21803">Answer 22:</a></strong> <a href="ch04.html#ch04que09">In most C and C++ implementations, there is no way of checking that a pointer actually points to valid memory. A common mistake is to deallocate a block of memory and reference that memory later in the program. By then, the memory pointed to may well have been reallocated to some other purpose. By setting the pointer to <code>NULL</code>, the programmers hope to prevent these rogue references—in most cases, dereferencing a NULL pointer will generate a runtime error</a>.</p>
<p class="docText"><a id="d1e21833"></a><strong><a href="app02.html#ch04ans10">Exercise 23:</a></strong> <em>from <a href="ch04.html#ch04lev1sec5">How to Balance Resources</a> on page <a href="ch04.html#page_136">136</a></em></p>
<p class="docText">Some Java developers make a point of setting an object variable to <code>NULL</code> after they have finished using the object. Why is this a good idea?</p>
<p class="docText"><a id="ch04ans10"></a><strong><a href="#d1e21833">Answer 23:</a></strong> <a href="ch04.html#ch04que10">By setting the reference to <code>NULL</code>, you reduce the number of pointers to the referenced object by one. Once this count reaches zero, the object is eligible for garbage collection. Setting the references to <code>NULL</code> can be significant for long-running programs, where the programmers need to ensure that memory utilization doesn't increase over time</a>.</p>
<p class="docText"><a id="page_293"></a><a id="d1e21869"></a><strong><a href="app02.html#ch05ans01">Exercise 24:</a></strong> <em>from <a href="ch05.html#ch05lev1sec1">Decoupling and the Law of Demeter</a> on page <a href="ch05.html#page_143">143</a></em></p>
<p class="docText">We discussed the concept of physical decoupling in the box on page <a href="ch05.html#page_142">142</a>. Which of the following C++ header files is more tightly coupled to the rest of the system?</p>
<p class="image1"><img src="images/293tab01.jpg" alt="image" /></p>
<p class="docText"><a id="ch05ans01"></a><strong><a href="#d1e21869">Answer 24:</a></strong> <a href="ch05.html#ch05que01">A header file is supposed to define the interface between the corresponding implementation and the rest of the world. The header file itself has no need to know about the internals of the <code>Date</code> class—it merely needs to tell the compiler that the constructor takes a <code>Date</code> as a parameter. So, unless the header file uses <code>Dates</code> in inline functions, the second snippet will work fine</a>.</p>
<p class="docText">What's wrong with the first snippet? On a small project, nothing, except that you are unnecessarily making everything that uses a <code>Person1</code> class also include the header file for <code>Date.</code> Once this kind of usage gets common in a project, you soon find that including one header file ends up including most of the rest of the system—a serious drag on compilation times.</p>
<p class="docText"><a id="d1e21962"></a><strong><a href="app02.html#ch05ans02">Exercise 25:</a></strong> <em>from <a href="ch05.html#ch05lev1sec1">Decoupling and the Law of Demeter</a> on page <a href="ch05.html#page_143">143</a></em></p>
<p class="docText">For the example below and for those in Exercises 26 and 27, determine if the method calls shown are allowed according to the Law of Demeter. This first one is in Java.</p>
<p class="progimage"><img src="images/p0293-02.jpg" alt="image" /></p>
<p class="docText"><a id="ch05ans02"></a><strong><a href="#d1e21962">Answer 25:</a></strong> <a href="ch05.html#ch05que02">The variable <code>acct</code> is passed in as a parameter, so the <code>getBalance</code> call is allowed. Calling <code>amt.printFormat(),</code> however, is not. We don't "own" <code>amt</code> and it wasn't passed to us. We could eliminate <code>showBalance's</code> coupling to <code>Money</code> with something like this</a> :</p>
<p class="progimage"><img src="images/p0293-03.jpg" alt="image" /></p>
<p class="docText"><a id="page_294"></a><a id="d1e22022"></a><strong><a href="app02.html#ch05ans03">Exercise 26:</a></strong> <em>from <a href="ch05.html#ch05lev1sec1">Decoupling and the Law of Demeter</a> on page <a href="ch05.html#page_143">143</a></em></p>
<p class="docText">This example is also in Java.</p>
<p class="progimage"><img src="images/p0294-01.jpg" alt="image" /></p>
<p class="docText"><a id="ch05ans03"></a><strong><a href="#d1e22022">Answer 26:</a></strong> <a href="ch05.html#ch05que03">Since <code>Colada</code> creates and owns both <code>myBlender</code> and <code>myStuff,</code> the calls to <code>addIngredients</code> and <code>elements</code> are allowed</a>.</p>
<p class="docText"><a id="d1e22088"></a><strong><a href="app02.html#ch05ans04">Exercise 27:</a></strong> <em>from <a href="ch05.html#ch05lev1sec1">Decoupling and the Law of Demeter</a> on page <a href="ch05.html#page_143">143</a></em></p>
<p class="docText">This example is in C++.</p>
<p class="progimage"><img src="images/p0294-02.jpg" alt="image" /></p>
<p class="docText"><a id="ch05ans04"></a><strong><a href="#d1e22088">Answer 27:</a></strong> <a href="ch05.html#ch05que04">In this case, <code>processTransaction</code> owns <code>amt</code>—it is created on the stack, <code>acct</code> is passed in, so both <code>setValue</code> and <code>setBalance</code> are allowed. But <code>processTransaction</code> does not own <code>who</code>, so the call <code>who-&gt;name()</code> is in violation. The Law of Demeter suggests replacing this line with</a></p>
<p class="programlisting">    markWorkflow(acct.name(), SET_BALANCE);</p>
<p class="docText">The code in <code>processTransaction</code> should not have to know which subobject within a <code>BankAccount</code> holds the name—this structural knowledge should not show through <code>BankAccount's</code> contract. Instead, we ask the <code>BankAccount</code> for the name on the account. It knows where it keeps the name (maybe in a <code>Person,</code> in a <code>Business,</code> or in a polymorphic <code>Customer</code> object).</p>
<p class="docText"><a id="page_295"></a><a id="d1e22179"></a><strong><a href="app02.html#ch05ans05">Exercise 28:</a></strong> <em>from <a href="ch05.html#ch05lev1sec2">Metaprogramming</a> on page <a href="ch05.html#page_149">149</a></em></p>
<p class="docText">Which of the following things would be better represented as code within a program, and which externally as metadata?</p>
<ol>
<li>Communication port assignments</li>
<li>An editor's support for highlighting the syntax of various languages</li>
<li>An editor's support for different graphic devices</li>
<li>A state machine for a parser or scanner</li>
<li>Sample values and results for use in unit testing</li>
</ol>
<p class="docText"><a id="ch05ans05"></a><strong><a href="#d1e22179">Answer 28:</a></strong> <a href="ch05.html#ch05que05">There are no definitive answers here—the questions were intended primarily to give you food for thought. However, this is what we think</a>:</p>
<ol>
<li><a id="d1e22230"></a><strong>Communication port assignments.</strong> Clearly, this information should be stored as metadata. But to what level of detail? Some Windows communications programs let you select only baud rate and port (say <code>COM1</code> to <code>COM4</code>). But perhaps you need to specify word size, parity, stop bits, and the duplex setting as well. Try to allow the finest level of detail where practical.</li>
<li><a id="d1e22244"></a><strong>An editor's support for highlighting the syntax of various languages.</strong> This should be implemented as metadata. You wouldn't want to have to hack code just because the latest version of Java introduced a new keyword.</li>
<li><a id="d1e22252"></a><strong>An editor's support for different graphic devices.</strong> This would probably be difficult to implement strictly as metadata. You would not want to burden your application with multiple device drivers only to select one at runtime. You could, however, use metadata to specify the name of the driver and dynamically load the code. This is another good argument for keeping the metadata in a human-readable format; if you use the program to set up a dysfunctional video driver, you may not be able to use the program to set it back.</li>
<li><a id="d1e22260"></a><strong>A state machine for a parser or scanner.</strong> This depends on what you are parsing or scanning. If you are parsing some data that is rigidly defined by a standards body and is unlikely to change without an act of Congress, then hard coding it is fine. But if you are faced with a more volatile situation, it may be beneficial to define the state tables externally.</li>
<li><a id="d1e22268"></a><strong>Sample values and results for use in unit testing.</strong> Most applications define these values inline in the testing harness, but you can get better flexibility by moving the test data—and the definition of the acceptable results—out of the code itself.</li>
</ol>
<p class="docText"><a id="page_296"></a><a id="d1e22282"></a><strong><a href="app02.html#ch05ans06">Exercise 29:</a></strong> <em>from <a href="ch05.html#ch05lev1sec4">It's Just a View</a> on page <a href="ch05.html#page_164">164</a></em></p>
<p class="docText">Suppose you have an airline reservation system that includes the concept of a flight:</p>
<p class="progimage"><img src="images/p0296-01.jpg" alt="image" /></p>
<p class="docText">If you add a passenger to the wait list, they'll be put on the flight automatically when an opening becomes available.</p>
<p class="docText">There's a massive reporting job that goes through looking for overbooked or full flights to suggest when additional flights might be scheduled. It works fine, but it takes hours to run.</p>
<p class="docText">We'd like to have a little more flexibility in processing wait-list passengers, and we've got to do something about that big report—it takes too long to run. Use the ideas from this section to redesign this interface.</p>
<p class="docText"><a id="ch05ans06"></a><strong><a href="#d1e22282">Answer 29:</a></strong> <a href="ch05.html#ch05que06">We'll take <code>Flight</code> and add some additional methods for maintaining two lists of listeners: one for wait-list notification, and the other for full-flight notification</a>.</p>
<p class="progimage"><img src="images/p0296-02.jpg" alt="image" /></p>
<p class="docText">If we try to add a <code>Passenger</code> and fail because the flight is full, we can, optionally, put the <code>Passenger</code> on the wait list. When a spot opens up, <code>waitList-Available</code> will be called. This method can then choose to add the <code>Passenger</code> automatically, or have a service representative call the customer to ask if they are still interested, or whatever. We now have the flexibility to perform different behaviors on a per-customer basis.</p>
<p class="docText">Next, we want to avoid having the <code>BigReport</code> troll through tons of records looking for full flights. By having <code>BigReport</code> registered as a listener on <code>Flights,</code> <a id="page_297"></a>each individual <code>Flight</code> can report when it is full—or nearly full, if we want. Now users can get live, up-to-the-minute reports from <code>BigReport</code> instantly, without waiting hours for it to run as it did previously.</p>
<p class="docText"><a id="d1e22418"></a><strong><a href="app02.html#ch05ans07">Exercise 30:</a></strong> <em>from <a href="ch05.html#ch05lev1sec5">Blackboards</a> on page <a href="ch05.html#page_170">170</a></em></p>
<p class="docText">For each of the following applications, would a blackboard system be appropriate or not? Why?</p>
<ol>
<li><a id="d1e22435"></a><strong>Image processing.</strong> You'd like to have a number of parallel processes grab chunks of an image, process them, and put the completed chunk back.</li>
<li><a id="d1e22443"></a><strong>Group calendaring.</strong> You've got people scattered across the globe, in different time zones, and speaking different languages, trying to schedule a meeting.</li>
<li><a id="d1e22451"></a><strong>Network monitoring tool.</strong> The system gathers performance statistics and collects trouble reports. You'd like to implement some agents to use this information to look for trouble in the system.</li>
</ol>
<p class="docText"><a id="ch05ans07"></a><strong><a href="#d1e22418">Answer 30:</a></strong></p>
<ol>
<li><a id="d1e22468"></a><strong>Image processing.</strong> For simple scheduling of a workload among the parallel processes, a shared work queue may be more than adequate. You might want to consider a blackboard system if there is feedback involved—that is, if the results of one processed chunk affect other chunks, as in machine vision applications, or complex 3D image-warp transforms.</li>
<li><a id="d1e22476"></a><strong>Group calendaring.</strong> This might be a good fit. You can post scheduled meetings and availability to the blackboard. You have entities functioning autonomously, feedback from decisions is important, and participants may come and go.<br/>You might want to consider partitioning this kind of blackboard system depending on who is searching: junior staff may care about only the immediate office, human resources may want only English-speaking offices worldwide, and the CEO may want the whole enchilada. There is also some flexibility on data formats: we are free to ignore formats or languages we don't understand. We have to understand different formats only for those offices that have meetings with each other, and we do not need to expose all participants to a full transitive closure of all possible formats. This reduces coupling to where it is necessary, and does not constrain us artificially.</li>
<li><a id="d1e22486"></a><strong>Network monitoring tool.</strong> This is very similar to the mortgage/loan application program described on page <a href="ch05.html#page_168">168</a>. You've got trouble reports sent in by users and statistics reported automatically, all posting to the blackboard. A human or software agent can analyze the blackboard to diagnose <a id="page_298"></a>network failures: two errors on a line might just be cosmic rays, but 20,000 errors and you've got a hardware problem. Just as the detectives solve the murder mystery, you can have multiple entities analyzing and contributing ideas to solve the network problems.</li>
</ol>
<p class="docText"><a id="d1e22500"></a><strong><a href="app02.html#ch06ans01">Exercise 31:</a></strong> <em>from <a href="ch06.html#ch06lev1sec1">Programming by Coincidence</a> on page <a href="ch06.html#page_176">176</a></em></p>
<p class="docText">Can you identify some coincidences in the following C code fragment? Assume that this code is buried deep in a library routine.</p>
<p class="rogramlisting">    fprintf (stderr, <em>"Error, continue?"</em>);<br/>    gets(buf);</p>
<p class="docText"><a id="ch06ans01"></a><strong><a href="#d1e22500">Answer 31:</a></strong> <a href="ch06.html#ch06que01">There are several potential problems with this code. First, it assumes a <code>tty</code> environment. That may be fine if the assumption is true, but what if this code is called from a GUI environment where neither <code>stderr</code> nor <code>stdin</code> is open</a>?</p>
<p class="docText">Second, there is the problematic <code>gets,</code> which will write as many characters as it receives into the buffer passed in. Malicious users have used this failing to create <em>buffer overrun</em> security holes in many different systems. Never use <code>gets().</code></p>
<p class="docText">Third, the code assumes the user understands English.</p>
<p class="docText">Finally, no one in their right mind would ever bury user interaction such as this in a library routine.</p>
<p class="docText"><a id="d1e22559"></a><strong><a href="app02.html#ch06ans02">Exercise 32:</a></strong> <em>from <a href="ch06.html#ch06lev1sec1">Programming by Coincidence</a> on page <a href="ch06.html#page_176">176</a></em></p>
<p class="docText">This piece of C code might work some of the time, on some machines. Then again, it might not. What's wrong?</p>
<p class="progimage"><img src="images/p0298-01.jpg" alt="image" /></p>
<p class="docText"><a id="ch06ans02"></a><strong><a href="#d1e22559">Answer 32:</a></strong> <a href="ch06.html#ch06que02">POSIX <code>strcpy</code> isn't guaranteed to work for overlapping strings. It might happen to work on some architectures, but only by coincidence</a>.</p>
<p class="docText"><a id="page_299"></a><a id="d1e22610"></a><strong><a href="app02.html#ch06ans03">Exercise 33:</a></strong> <em>from <a href="ch06.html#ch06lev1sec1">Programming by Coincidence</a> on page <a href="ch06.html#page_177">177</a></em></p>
<p class="docText">This code comes from a general-purpose Java tracing suite. The function writes a string to a log file. It passes its unit test, but fails when one of the Web developers uses it. What coincidence does it rely on?</p>
<p class="progimage"><img src="images/p0299-01.jpg" alt="image" /></p>
<p class="docText"><a id="ch06ans03"></a><strong><a href="#d1e22610">Answer 33:</a></strong> <a href="ch06.html#ch06que03">It won't work in an applet context with security restrictions against writing to the local disk. Again, when you have a choice of running in GUI contexts or not, you may want to check dynamically to see what the current environment is like. In this case, you may want to put a log file somewhere other than the local disk if it isn't accessible</a>.</p>
<p class="docText"><a id="d1e22658"></a><strong><a href="app02.html#ch06ans04">Exercise 34:</a></strong> <em>from <a href="ch06.html#ch06lev1sec2">Algorithm Speed</a> on page <a href="ch06.html#page_183">183</a></em></p>
<p class="docText">We have coded a set of simple sort routines, which can be downloaded from our Web site (<a href="http://www.pragmaticprogrammer.com">www.pragmaticprogrammer.com</a>). Run them on various machines available to you. Do your figures follow the expected curves? What can you deduce about the relative speeds of your machines? What are the effects of various compiler optimization settings? Is the radix sort indeed linear?</p>
<p class="docText"><a id="ch06ans04"></a><strong><a href="#d1e22658">Answer 34:</a></strong> <a href="ch06.html#ch06que04">Clearly, we can't give any absolute answers to this exercise. However, we can give you a couple of pointers</a>.</p>
<p class="docText">If you find that your results don't follow a smooth curve, you might want to check to see if some other activity is using some of your processor's power. You probably won't get good figures on a multiuser system, and even if you are the only user you may find that background processes periodically take cycles away from your programs. You might also want to check memory: if the application starts using swap space, performance will nose dive.</p>
<p class="docText">It is interesting to experiment with different compilers and different optimization settings. We found some that pretty startling speed-ups were possible by enabling aggressive optimization. We also found that on the wider RISC architectures the manufacturer's compilers often outperformed the more portable GCC. Presumably, the manufacturer is privy to the secrets of efficient code generation on these machines.</p>
<p class="docText"><a id="page_300"></a><a id="d1e22691"></a><strong><a href="app02.html#ch06ans05">Exercise 35:</a></strong> <em>from <a href="ch06.html#ch06lev1sec2">Algorithm Speed</a> on page <a href="ch06.html#page_183">183</a></em></p>
<p class="docText">The routine below prints out the contents of a binary tree. Assuming the tree is balanced, roughly how much stack space will the routine use while printing a tree of 1,000,000 elements? (Assume that subroutine calls impose no significant stack overhead.)</p>
<p class="progimage"><img src="images/p0300-01.jpg" alt="image" /></p>
<p class="docText"><a id="ch06ans05"></a><strong><a href="#d1e22691">Answer 35:</a></strong> <a href="ch06.html#ch06que05">The <code>printTree</code> routine uses about 1,000 bytes of stack space for the <code>buffer</code> variable. It calls itself recursively to descend through the tree, and each nested call adds another 1,000 bytes to the stack. It also calls itself when it gets to the leaf nodes, but exits immediately when it discovers that the pointer passed in is <code>NULL</code>. If the depth of the tree is <em>D,</em> the maximum stack requirement is therefore roughly 1000 x <em>(D +</em> 1)</a>.</p>
<p class="docText">A balanced binary tree holds twice as many elements at each level. A tree of depth D holds 1 + 2+4+8 + ... + 2<sup></sup><em><sup>D</sup></em><sup>–1)</sup>, or 2<em><sup>D</sup></em><sup>–</sup>1, elements. Our million-element tree will therefore need | lg(l,000,001) |, or 20 levels.</p>
<p class="docText">We'd therefore expect our routine to use roughly 21,000 bytes of stack.</p>
<p class="docText"><a id="d1e22767"></a><strong><a href="app02.html#ch06ans06">Exercise 36:</a></strong> <em>from <a href="ch06.html#ch06lev1sec2">Algorithm Speed</a> on page <a href="ch06.html#page_183">183</a></em></p>
<p class="docText">Can you see any way to reduce the stack requirements of the routine in Exercise 35 (apart from reducing the size of the buffer)?</p>
<p class="docText"><a id="ch06ans06"></a><strong><a href="#d1e22767">Answer 36:</a></strong> <a href="ch06.html#ch06que06">A couple of optimizations come to mind. First, the <code>printTree</code> routine calls itself on leaf nodes, only to exit because there are no children. That call increases the maximum stack depth by about 1,000 bytes. We can also eliminate the tail recursion (the second recursive call), although this won't affect the worst-case stack usage</a>.</p>
<p class="progimage"><img src="images/p0300-02.jpg" alt="image" /></p>
<p class="docText"><a id="page_301"></a>The biggest gain, however, comes from allocating just a single buffer, shared by all invocations of <code>printTree</code>. Pass this buffer as a parameter to the recursive calls, and only 1,000 bytes will be allocated, regardless of the depth of recursion.</p>
<p class="progimage"><img src="images/p0301-01.jpg" alt="image" /></p>
<p class="docText"><a id="d1e22835"></a><strong><a href="app02.html#ch06ans07">Exercise 37:</a></strong> <em>from <a href="ch06.html#ch06lev1sec2">Algorithm Speed</a> on page <a href="ch06.html#page_183">183</a></em></p>
<p class="docText">On page <a href="ch06.html#page_180">180</a>, we claimed that a binary chop is <em>O</em>(<em>lg</em>(<em>n</em>))<em>.</em> Can you prove this?</p>
<p class="docText"><a id="ch06ans07"></a><strong><a href="#d1e22835">Answer 37:</a></strong> <a href="ch06.html#ch06que07">There are a couple of ways of getting there. One is to turn the problem on its head. If the array has just one element, we don't iterate around the loop. Each additional iteration doubles the size of the array we can search. The general formula for the array size is therefore <em>n</em> = 2<em><sup>m</sup>,</em> where <em>m</em> is the number of iterations. If you take logs to the base 2 of each side, you get lg(<em>n</em>) = lg(2<em><sup>m</sup></em>), which by the definition of logs becomes lg(<em>n</em>) = <em>m.</em></a></p>
<p class="docText"><a id="d1e22896"></a><strong><a href="app02.html#ch06ans08">Exercise 38:</a></strong> <em>from <a href="ch06.html#ch06lev1sec3">Refactoring</a> on page <a href="ch06.html#page_188">188</a></em></p>
<p class="docText">The following code has obviously been updated several times over the years, but the changes haven't improved its structure. Refactor it.</p>
<p class="progimage"><img src="images/p0301-02.jpg" alt="image" /></p>
<p class="docText"><a id="page_302"></a><a id="ch06ans08"></a><strong><a href="#d1e22896">Answer 38:</a></strong> <a href="ch06.html#ch06que08">We might suggest a fairly mild restructuring here: make sure that every test is performed just once, and make all the calculations common. If the expression <code>2*basis(. . .) * 1.05</code> appears in other places in the program, we should probably make it a function. We haven't bothered here</a>.</p>
<p class="docText">We've added a <code>rate_lookup</code> array, initialized so that entries other than Texas, Ohio, and Maine have a value of 1. This approach makes it easy to add values for other states in the future. Depending on the expected usage pattern, we might want to make the <code>points</code> field an array lookup as well.</p>
<p class="progimage"><img src="images/p0302-01.jpg" alt="image" /></p>
<p class="docText"><a id="d1e22959"></a><strong><a href="app02.html#ch06ans09">Exercise 39:</a></strong> <em>from <a href="ch06.html#ch06lev1sec3">Refactoring</a> on page <a href="ch06.html#page_188">188</a></em></p>
<p class="docText">The following Java class needs to support a few more shapes. Refactor the class to prepare it for the additions.</p>
<p class="progimage"><img src="images/p0302-02.jpg" alt="image" /></p>
<p class="docText"><a id="page_303"></a><a id="ch06ans09"></a><strong><a href="#d1e22959">Answer 39:</a></strong> <a href="ch06.html#ch06que09">When you see someone using enumerated types (or their equivalent in Java) to distinguish between variants of a type, you can often improve the code by subclassing</a>:</p>
<p class="progimage"><img src="images/p0303-01.jpg" alt="image" /></p>
<p class="docText"><a id="d1e23130"></a><strong><a href="app02.html#ch06ans10">Exercise 40:</a></strong> <em>from <a href="ch06.html#ch06lev1sec3">Refactoring</a> on page <a href="ch06.html#page_189">189</a></em></p>
<p class="docText">This Java code is part of a framework that will be used throughout your project. Refactor it to be more general and easier to extend in the future.</p>
<p class="progimage"><img src="images/p0303-02.jpg" alt="image" /></p>
<p class="docText"><a id="ch06ans10"></a><strong><a href="#d1e23130">Answer 40:</a></strong> <a href="ch06.html#ch06que10">This case is interesting. At first sight, it seems reasonable that a window should have a width and a height. However, consider the future. Let's imagine that we want to support arbitrarily shaped windows (which will be difficult if the <code>Window</code> class knows all about rectangles and their properties)</a>.</p>
<p class="docText">We'd suggest abstracting the shape of the window out of the <code>Window</code> class itself.</p>
<p class="docText"><a id="page_304"></a></p>
<p class="progimage"><img src="images/p0304-01.jpg" alt="image" /></p>
<p class="docText">Note that in this approach we've used delegation rather than subclassing: a window is not a "kind-of" shape—a window "has-a" shape. It uses a shape to do its job. You'll often find delegation useful when refactoring.</p>
<p class="docText">We could also have extended this example by introducing a Java interface that specified the methods a class must support to support the shape functions. This is a good idea. It means that when you extend the concept of a shape, the compiler will warn you about classes that you have affected. We recommend using interfaces this way when you delegate all the functions of some other class.</p>
<p class="docText"><a id="d1e23255"></a><strong><a href="app02.html#ch06ans11">Exercise 41:</a></strong> <em>from <a href="ch06.html#ch06lev1sec4">Code That's Easy to Test</a> on page <a href="ch06.html#page_197">197</a></em></p>
<p class="docText">Design a test jig for the blender interface described in the answer to Exercise 17 on page <a href="app02.html#page_289">289</a>. Write a shell script that will perform a regression test for the blender. You need to test basic functionality, error and boundary conditions, and any contractual obligations. What restrictions are placed on changing the speed? Are they being honored?</p>
<p class="docText"><a id="page_305"></a><a id="ch06ans11"></a><strong><a href="#d1e23255">Answer 41:</a></strong> <a href="ch06.html#ch06que11">First, we'll add a <code>main</code> to act <em>as a</em> unit test driver. It will accept a very small, simple language as an argument: "E" to empty the blender, "F" to fill it, digits 0-9 to set the speed, and so on</a>.</p>
<p class="progimage"><img src="images/p0305-01.jpg" alt="image" /></p>
<p class="docText">Next comes the shell script to drive the tests.</p>
<p class="docText"><a id="page_306"></a></p>
<p class="progimage"><img src="images/p0306-01.jpg" alt="image" /></p>
<p class="docText">The tests check to see if illegal speed changes are detected, if you try to empty the blender while running, and so on. We put this in the makefile so we can compile and run the regression test by simply typing</p>
<p class="programlisting">      % make<br/>      % make <strong>test</strong></p>
<p class="docText">Note that we have the test exit with <code>0</code> or <code>1</code> so we can use this as part of a larger test as well.</p>
<p class="docText">There was nothing in the requirements that spoke of driving this component via a script, or even using a language. End users will never see it. But we have a powerful tool that we can use to test our code, quickly and exhaustively.</p>
<p class="docText"><a id="page_307"></a><a id="d1e23513"></a><strong><a href="app02.html#ch07ans01">Exercise 42:</a></strong> <em>from <a href="ch07.html#ch07lev1sec1">The Requirements Pit</a> on page <a href="ch07.html#page_211">211</a></em></p>
<p class="docText">Which of the following are probably genuine requirements? Restate those that are not to make them more useful (if possible).</p>
<ol>
<li>The response time must be less than 500 ms.</li>
<li>Dialog boxes will have a gray background.</li>
<li>The application will be organized as a number of front-end processes and a back-end server.</li>
<li>If a user enters non-numeric characters in a numeric field, the system will beep and not accept them.</li>
<li>The application code and data must fit within 256kB.</li>
</ol>
<p class="docText"><a id="ch07ans01"></a><strong><a href="#d1e23513">Answer 42:</a></strong></p>
<ol>
<li>This statement sounds like a real requirement: there may be constraints placed on the application by its environment.</li>
<li>Even though this may be a corporate standard, it isn't a requirement. It would be better stated as "The dialog background must be configurable by the end user. As shipped, the color will be gray." Even better would be the broader statement "All visual elements of the application (colors, fonts, and languages) must be configurable by the end user."</li>
<li>This statement is not a requirement, it's architecture. When faced with something like this, you have to dig deep to find out what the user is thinking.</li>
<li>The underlying requirement is probably something closer to "The system will prevent the user from making invalid entries in fields, and will warn the user when these entries are made."</li>
<li>This statement is probably a hard requirement.<br/>
<p class="image"><img src="images/bfig01.gif" alt="image" /></p></li>
</ol>
</div>
</body>
</html>